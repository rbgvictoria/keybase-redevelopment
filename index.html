<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
        <meta http-equiv="x-ua-compatible" content="ie=edge">
        <meta name="description" content="Introduction">

        <meta property="og:site_name" content="KeyBase redevelopment"/>
        <meta property="og:title" content="KeyBase redevelopment | KeyBase redevelopment"/>
        <meta property="og:description" content="Introduction"/>
        <meta property="og:url" content="https://rbgvictoria.github.io/keybase-redevelopment/"/>
        <meta property="og:image" content="https://rbgvictoria.github.io/keybase-redevelopment/assets/img/keybase.png"/>
        <meta property="og:type" content="website"/>

        <meta name="twitter:image:alt" content="KeyBase redevelopment">
        <meta name="twitter:card" content="summary_large_image">

        
        <title>KeyBase redevelopment | KeyBase redevelopment</title>

        <link rel="home" href="https://rbgvictoria.github.io/keybase-redevelopment">
        <link rel="icon" href="/favicon.ico">

        
                    <!-- Insert analytics code here -->
        
        <link href="https://fonts.googleapis.com/css?family=Nunito+Sans:300,300i,400,400i,700,700i,800,800i" rel="stylesheet">
        <link rel="stylesheet" href="https://rbgvictoria.github.io/keybase-redevelopment/assets/build/css/main.css?id=a3a954e6d07a691c2b89671425e5af69">


            </head>

    <body class="flex flex-col justify-between min-h-screen bg-gray-50 text-gray-800 leading-normal font-sans">
        <header class="flex items-center shadow bg-sky-600 border-b h-24 mb-8 py-4" role="banner">
            <div class="container flex items-center max-w-8xl mx-auto px-4 lg:px-8">
                <div class="flex items-center">
                    <a href="https://rbgvictoria.github.io/keybase-redevelopment" title="KeyBase redevelopment home" class="inline-flex items-center">
                        <img class="h-8 md:h-10 mr-3" src="https://rbgvictoria.github.io/keybase-redevelopment/assets/img/keybase-logo-80.png" alt="KeyBase redevelopment logo" />
                        <h1 class="text-lg md:text-2xl text-white font-semibold hover:text-gray-200 my-0 pr-4">KeyBase redevelopment</h1>
                    </a>
                </div>

                <div class="flex flex-1 justify-end items-center text-right md:pl-10">
                                    </div>
            </div>

                <button class="flex justify-center items-center bg-gray-50 border bg-gray-50 h-10 mr-4 px-5 rounded-full lg:hidden focus:outline-none"
    onclick="navMenu.toggle()"
    aria-label="nav menu"
>
    <svg id="js-nav-menu-show" xmlns="http://www.w3.org/2000/svg"
        class="fill-current text-sky-700 h-9 w-4" viewBox="0 0 32 32"
    >
        <path d="M4,10h24c1.104,0,2-0.896,2-2s-0.896-2-2-2H4C2.896,6,2,6.896,2,8S2.896,10,4,10z M28,14H4c-1.104,0-2,0.896-2,2  s0.896,2,2,2h24c1.104,0,2-0.896,2-2S29.104,14,28,14z M28,22H4c-1.104,0-2,0.896-2,2s0.896,2,2,2h24c1.104,0,2-0.896,2-2  S29.104,22,28,22z"/>
    </svg>

    <svg id="js-nav-menu-hide" xmlns="http://www.w3.org/2000/svg"
        class="hidden fill-current text-white h-9 w-4" viewBox="0 0 36 30"
    >
        <polygon points="32.8,4.4 28.6,0.2 18,10.8 7.4,0.2 3.2,4.4 13.8,15 3.2,25.6 7.4,29.8 18,19.2 28.6,29.8 32.8,25.6 22.2,15 "/>
    </svg>
</button>

        </header>

        <main role="main" class="w-full flex-auto">
            <section class="container max-w-8xl mx-auto px-6 md:px-8 py-4">
    <div class="flex flex-col lg:flex-row">
        <nav id="js-nav-menu" class="nav-menu hidden lg:block">
            <ul class="my-0">
            <li class="pl-4">
            
        <a href="https://rbgvictoria.github.io/keybase-redevelopment/docs/keybase-data-model"
            class="lvl0   nav-menu__item hover:text-blue-500"
        >
            KeyBase data model
        </a>
    
    </li>
            <li class="pl-4">
            
        <a href="https://rbgvictoria.github.io/keybase-redevelopment/docs/keybase-organisational-model"
            class="lvl0   nav-menu__item hover:text-blue-500"
        >
            KeyBase organisational model
        </a>
    
    </li>
            <li class="pl-4">
            
        <a href="https://rbgvictoria.github.io/keybase-redevelopment/docs/processing-keys"
            class="lvl0   nav-menu__item hover:text-blue-500"
        >
            Processing keys
        </a>
    
    </li>
    </ul>
        </nav>

        <div class="docsearch-content w-full lg:w-3/5 break-words pb-16 lg:pl-4" v-pre>
            <h1>KeyBase redevelopment</h1>
<p>KeyBase is an application that makes traditional dichotomous identification keys
suitable for use on the web and that people can use to manage keys for use in
other applications. It has also been used by many people to create stand-alone
projects that live entirely within KeyBase. The mission of KeyBase, however, is
to make pathway keys on the web and nothing else, so KeyBase will never include
profiles, or images, or references, which are jobs for other services.</p>
<p>KeyBase has been managed by the Royal Botanic Gardens Victoria since 2011.</p>
<p>KeyBase has a plugin that people can use in their own applications that provides
keys in the form of an interactive key player, a bracketed key and an indented
key. Applications that use the plugin can choose which type of keys they want to
run. VicFlora, for example, only uses the interactive player and the bracketed
key. It also offers the option to filter items in a key, that applications can
choose to implement or not (VicFlora does not use it).</p>
<p>KeyBase does not currently have an editor, but people have always been able to
upload keys as CSV files. The homepage being defaced by a hacker in December
2023, however, forced us to turn off this functionality.</p>
<p>The aim of the current redevelopment is to convert KeyBase from a
proof-of-concept to a production-ready web application. The main focus will be
on securing the application, so that we can make the upload functionality
available again. In the process, we will also modernise the application and
bring it in line with modern web architecture and design. We’ll also make sure
that KeyBase can be maintained by developers that do not have to know KeyBase
inside-out so that we do not again end up with ten years of technical debt.</p>
<p>The KeyBase plugin is also old, but it is working fine, so upgrading that will
be left for a next phase.</p>
<h2><a id="content-current-codebase" href="#content-current-codebase" class="heading-permalink" aria-hidden="true" title="Permalink"></a>Current codebase</h2>
<p>The code for the current iteration of KeyBase is in the following GitHub
repositories:</p>
<p>Application: <a href="https://github.com/rbgvictoria/keybase">https://github.com/rbgvictoria/keybase</a></p>
<p>API: <a href="https://github.com/rbgvictoria/keybase-ws">https://github.com/rbgvictoria/keybase-ws</a></p>
<p>The code for the KeyBase plugin, which is the only bit I had thought we’d leave
intact for now, is at
<a href="https://github.com/rbgvictoria/keybase/blob/master/js/jquery.keybase.key.js">https://github.com/rbgvictoria/keybase/blob/master/js/jquery.keybase.key.js</a>.
This needs to be changed to vanilla Javascript though before we do the
redevelopment of VicFlora next (financial) year. @twocngdagz, please make a
judgement whether we should replace it as part of this project, or whether we
should postpone it. If we are going to do it now, there are some changes I would
like to make.</p>
<h2><a id="content-licensing" href="#content-licensing" class="heading-permalink" aria-hidden="true" title="Permalink"></a>Licensing</h2>
<p>We have agreed to share the copyright for all the code between Fast Flow
Management (FFM) and the Royal Botanic Gardens Victoria (RBGV). We’ll find an
appropriate Open Source licence to put on all the code.</p>
<h2><a id="content-architecture" href="#content-architecture" class="heading-permalink" aria-hidden="true" title="Permalink"></a>Architecture</h2>
<p>We have decided on an architecture of Laravel + Inertia + React.</p>
<p>KeyBase will have a REST-like API for GET requests, like it has now. In fact,
this API will change very little, as the KeyBase plugin requires JSON with a
very specific structure.</p>
<h2><a id="content-css-framework" href="#content-css-framework" class="heading-permalink" aria-hidden="true" title="Permalink"></a>CSS framework</h2>
<p>We will change the CSS framework from Bootstrap to Tailwind CSS, because
Tailwind works better with modern Javascript frameworks. This might change the
look and feel of the site, which is very bootstrappy at the moment.</p>
<h2><a id="content-api" href="#content-api" class="heading-permalink" aria-hidden="true" title="Permalink"></a>API</h2>
<p>The current API is documented at <a href="https://keybase.rbg.vic.gov.au/api">https://keybase.rbg.vic.gov.au/api</a>. We cannot
change too much to the API, because the plugin relies on a certain structure of
the JSO output for the keys and the Atlas of Living Australia (ALA) uses the
project endpoints for the Flora of Australia project in their Profiles.</p>
<p>Currently everything in KeyBase goes through the API. Because of our use of
Inertia, this is not really necessary in the new version but, if it is not too much extra work, I would like to keep it this way.</p>
<p>I will set up the the database structure and the public API endpoints myself
once the GitHub repository has been created.</p>
<h2><a id="content-authentication" href="#content-authentication" class="heading-permalink" aria-hidden="true" title="Permalink"></a>Authentication</h2>
<p>Authentication to KeyBase will be with ORCID. ORCID has been chosen, because it
is the only identifier we can require all KeyBase users to have. If we let
people log in using their ORCID, people will not be able to give fake email
addresses etc. The ORCID API also provides Multi-Factor Authentication.</p>
<p>More information at
<a href="https://info.orcid.org/what-is-orcid/services/public-api/orcid-as-a-sign-in-option-to-your-system/">https://info.orcid.org/what-is-orcid/services/public-api/orcid-as-a-sign-in-option-to-your-system/</a>.</p>
<p>I would like to have the complete OAuth2 workflow (so Laravel Passport rather
than Laravel Sanctum), so other developers can build their own applications
around the KeyBase service or fully integrate KeyBase into their applications.</p>
<h2><a id="content-authorization" href="#content-authorization" class="heading-permalink" aria-hidden="true" title="Permalink"></a>Authorization</h2>
<p>KeyBase consists of many projects. Users of a project can have one of two roles,
Manager or Contributor. Contributors can create, update and delete their own
keys, while Managers can do the same for all keys in a project. Managers can
also edit the project’s metadata, manage a project’s items separately from the
keys (this entails adding links to other websites), manage filters, and assign
other users to a project.</p>
<p>There should also be an Administrator role. Administrators can do everything in
KeyBase, including deleting inactive projects with no keys.</p>
<h2><a id="content-project-page" href="#content-project-page" class="heading-permalink" aria-hidden="true" title="Permalink"></a>Project page</h2>
<p>The project page has got four tabs: <strong>Keys</strong> (tree), <strong>Keys</strong> (list), <strong>About</strong>
and <strong>Contributors</strong>. Logged in users also get a <strong>Filters</strong> tab and Managers of
a project also get an <strong>Items</strong> tab.</p>
<p><img src="assets/images/keybase-redevelopment/image.png" alt="" /></p>
<ul>
<li>
<p>The content of the <strong>Keys</strong> tabs comes from the
<code>/project_keys_get/{projectId}</code> endpoint.</p>
</li>
<li>
<p>The <strong>Keys</strong> (tree) tab shows the keys in a tree structure (the output of the
<code>/project_keys_get</code> endpoint contains an adjacency list). This tree is
currently created using Dynatree (<a href="https://github.com/mar10/dynatree">https://github.com/mar10/dynatree</a>). This is
a JQuery library, so needs to be replaced with something vanilla Javascipt or
React.</p>
</li>
<li>
<p>The <strong>Keys</strong> (list) is just an alphabetical list of the keys.</p>
</li>
<li>
<p>The <strong>About</strong> page is populated by the output of the
<code>/project_meta_get/{projectId}</code> endpoint. It is just the description of the
project. We might see if we can put it somewhere more prominent.</p>
</li>
<li>
<p>The <strong>Contributors</strong> page lists the users in the project and their roles. I do
not know where the data comes from but in the new API it will be added to the
<code>projects/{id}</code> endpoint.</p>
</li>
<li>
<p>The <strong>Items</strong> tab currently only has an ‘Upload project items’ button that
project Managers can use to upload a CSV file with item labels and links. We
can put a table there that is viewable by everyone and editable by project
Managers.</p>
</li>
<li>
<p>VicFlora updates project items every night but does so directly into the
database. We should have an API endpoint for that.</p>
</li>
<li>
<p>The <strong>Filters</strong> tab currently only has a ‘Create new filter’ button that sends
people to the <code>/filters</code> page. We can drag the whole content of that page into
the <strong>Filter</strong> tab, as KeyBase is not going to have filters across projects.</p>
</li>
<li>
<p>The search box on the left replicates the functionality of the browser search
(CTRL + F). It needs an autocorrect that will get its data from the
<code>project_keys_get</code> API endpoint, like the first two tabs.</p>
</li>
</ul>
<h2><a id="content-key-page" href="#content-key-page" class="heading-permalink" aria-hidden="true" title="Permalink"></a>Key page</h2>
<p><img src="assets/images/keybase-redevelopment/image-1.png" alt="" /></p>
<h3><a id="content-interactive-key-bracketed-key-and-indented-key-tabs" href="#content-interactive-key-bracketed-key-and-indented-key-tabs" class="heading-permalink" aria-hidden="true" title="Permalink"></a>Interactive key, Bracketed key and Indented key tabs</h3>
<ul>
<li>
<p>The <strong>Interactive key</strong>, <strong>Bracketed key</strong> and <strong>Indented key</strong> are all
created by the KeyBase plugin, but some Javascript is required to start it up. I have done this in VicFlora (<a href="https://github.com/vicflora/vicflora-vue/tree/main/components/Keybase">https://github.com/vicflora/vicflora-vue/tree/main/components/Keybase</a>), but that is in VueJS, so will be slightly different from what we need here.</p>
</li>
<li>
<p>The KeyBase plugin has got hooks for CSS classes, so we can put Tailwind CSS
classes in there.</p>
</li>
<li>
<p>There are hooks for other customisations to the interface as well, but the
thing as made for KeyBase, so KeyBase mostly uses the defaults. We could use
it to make a responsive interactive key player though.</p>
</li>
</ul>
<h3><a id="content-about-tab" href="#content-about-tab" class="heading-permalink" aria-hidden="true" title="Permalink"></a>About tab</h3>
<ul>
<li>The <strong>About</strong> tab contains the keys metadata:</li>
</ul>
<p><img src="assets/images/keybase-redevelopment/image-2.png" alt="" /></p>
<ul>
<li>
<p>It also contains a list of the items that key out in a key (in the <strong>Items</strong>
tab) and gives access to the exports and the <strong>Edit</strong> page (for new keys the
<strong>Edit</strong> page is accessed from the <strong>Project</strong> page).</p>
</li>
<li>
<p>KeyBase exports currently come in five formats: CSV, TXT (tab-separated
values), LPXK (Lucid Phoenix Key format) SDD (Structured Descriptive Data
format) and KeyBase’s own format, which is in JSON. We can ditch LPXK and SDD,
as there are no applications that use these formats anymore.</p>
<p><img src="assets/images/keybase-redevelopment/image-3.png" alt="" /></p>
</li>
</ul>
<h3><a id="content-edit-key" href="#content-edit-key" class="heading-permalink" aria-hidden="true" title="Permalink"></a>Edit key</h3>
<p><img src="assets/images/keybase-redevelopment/image-4.png" alt="" /></p>
<ul>
<li>
<p>All metadata fields are shown in the screenshot above.</p>
</li>
<li>
<p>We will stop supporting the LPXK format anymore, so all uploaded keys will be
in CSV/TXT format. KeyBase will recognise the format. We also need to
recognise the encoding, as many people edit keys in Excel.</p>
</li>
<li>
<p>The form to provide the <strong>Source</strong> of the key is currently in a modal. I think it would be nicer to have it in a collapsible form section.</p>
</li>
</ul>
<p><img src="assets/images/keybase-redevelopment/image-5.png" alt="" /></p>
<ul>
<li>When uploading a new key file, you first get a screen to confirm if KeyBase
picked the right separator:</li>
</ul>
<p><img src="assets/images/keybase-redevelopment/image-6.png" alt="" /></p>
<ul>
<li>The next screen shows the result of the tests whether all the leads in the key have been correctly linked up:</li>
</ul>
<p><img src="assets/images/keybase-redevelopment/image-7.png" alt="" /></p>
<p>(I broke this one on purpose)</p>
<ul>
<li>
<p>If there are any errors in the key, the ‘OK’ button is disabled, so people
need to get back to the CSV file, fix the errors and re-upload it. Warnings
can be ignored, but users do so at their own peril. Keys with reticulations
(multiple leads that lead to the same couplet), for example, will not be
editable if KeyBase ever gets a key editor.</p>
</li>
<li>
<p>If there are no errors or warnings, this screen will not show and the key will
be loaded.</p>
</li>
<li>
<p>We discussed editable tables before and this would be a good place for one, as
mostly these errors are easily fixed.</p>
</li>
</ul>
<h2><a id="content-search" href="#content-search" class="heading-permalink" aria-hidden="true" title="Permalink"></a>Search</h2>
<ul>
<li>The <strong>Search</strong> box at the top of the page searches for keys across projects.</li>
</ul>
<p><img src="assets/images/keybase-redevelopment/image-8.png" alt="" /></p>
<ul>
<li>The <strong>Search</strong> box needs an autocomplete. There is an endpoint in the API for this (currently <code>/autocomplete_item_name</code>).</li>
</ul>
<h2><a id="content-filters" href="#content-filters" class="heading-permalink" aria-hidden="true" title="Permalink"></a>Filters</h2>
<ul>
<li>
<p>KeyBase has two types of filters, <strong>Local filters</strong> and <strong>Global filters</strong>.</p>
</li>
<li>
<p><strong>Local Filters</strong> are fully embedded in the KeyBase plugin, so nothing special
needs to be done for them.</p>
</li>
</ul>
<p><img src="assets/images/keybase-redevelopment/image-9.png" alt="" /></p>
<ul>
<li><strong>Global filters</strong> are managed on the <strong>Filters</strong> page. Only logged-in users
have access to that, because global filters are stored in the database.</li>
</ul>
<p><img src="assets/images/keybase-redevelopment/image-10.png" alt="" /></p>
<ul>
<li>
<p>A <strong>Global filter</strong> is basically a list of taxa (<strong>Items</strong> in KeyBase).
KeyBase only stores these items and only when the filter is applied looks for
the keys the items are in and other keys that need to be traversed to get to
these keys.</p>
</li>
<li>
<p>There are two types of global filters, ““User filters** (indicated as <strong>My filters</strong>) that every user and only they can see and <strong>Project filters</strong> that only project Managers can make but that everybody can see.</p>
</li>
<li>
<p>As the global filters are not really global anymore but apply to a single project, I would like to see if we can get rid of the <strong>Filter page</strong> and put it in the <strong>Filter tab</strong> on the <strong>Project page</strong>.</p>
</li>
</ul>
        </div>
    </div>
</section>
        </main>

        <script src="https://rbgvictoria.github.io/keybase-redevelopment/assets/build/js/main.js?id=1a0aaf8679875577ba674f7321274237"></script>

        <script>
    const navMenu = {
        toggle() {
            const menu = document.getElementById('js-nav-menu');
            menu.classList.toggle('hidden');
            menu.classList.toggle('lg:block');
            document.getElementById('js-nav-menu-hide').classList.toggle('hidden');
            document.getElementById('js-nav-menu-show').classList.toggle('hidden');
        },
    }
</script>

        <footer class="bg-white text-center text-sm mt-12 py-4" role="contentinfo">
            <ul class="flex flex-col md:flex-row justify-center">
                <li class="md:mr-2">
                    &copy; <a href="https://tighten.co" title="Tighten website">Tighten</a> 2025.
                </li>

                <li>
                    Built with <a href="http://jigsaw.tighten.co" title="Jigsaw by Tighten">Jigsaw</a>
                    and <a href="https://tailwindcss.com" title="Tailwind CSS, a utility-first CSS framework">Tailwind CSS</a>.
                </li>
            </ul>
        </footer>
    </body>
</html>
